<div class="detalle-container" *ngIf="compra; else loadingTemplate">

  <div class="header-action-row no-print">
    <button class="btn-back" (click)="volver()" title="Volver">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <div class="header-content">
      <h1>Detalle de {{ compra.tipoCompra | titlecase }}</h1>
      <h3>{{ compra.tipoComprobante }} {{ compra.serie }}-{{ compra.numero }}</h3>
    </div>
    <button class="btn-print" (click)="imprimir()"><mat-icon>print</mat-icon> Imprimir</button>
  </div>

  <div class="content-wrapper">
    
    <div class="info-column">
      <div class="card info-card">
        <h3><mat-icon>store</mat-icon> Proveedor</h3>
        <div class="info-row">
          <span class="label">Razón Social:</span>
          <span class="value fw-bold">{{ compra.nombreProveedor }}</span>
        </div>
        <div class="info-row">
          <span class="label">RUC:</span>
          <span class="value">{{ compra.rucProveedor }}</span>
        </div>
      </div>

      <div class="card info-card">
        <h3><mat-icon>event</mat-icon> Emisión</h3>
        <div class="info-row">
          <span class="label">Fecha:</span>
          <span class="value">{{ compra.fechaEmision | date:'dd/MM/yyyy' }}</span>
        </div>
        <div class="info-row">
          <span class="label">Moneda:</span>
          <span class="value">{{ compra.moneda }} (TC: {{compra.tipoCambio}})</span>
        </div>
      </div>
      
      <div class="card info-card" *ngIf="compra.percepcion > 0 || compra.detraccionMonto > 0">
         <h3><mat-icon>account_balance</mat-icon> Impuestos</h3>
         <div class="info-row" *ngIf="compra.percepcion > 0">
           <span class="label">Percepción:</span>
           <span class="value">{{ compra.percepcion | number:'1.2-2' }}</span>
         </div>
         <div class="info-row" *ngIf="compra.detraccionMonto > 0">
           <span class="label">Detracción ({{compra.detraccionPorcentaje}}%):</span>
           <span class="value">{{ compra.detraccionMonto | number:'1.2-2' }}</span>
         </div>
      </div>
    </div>

    <div class="products-column">
      <div class="card table-card">
        <h3><mat-icon>shopping_cart</mat-icon> Items</h3>
        <div class="table-responsive">
          <table class="custom-table">
            <thead>
              <tr>
                <th>Descripción</th>
                <th class="text-center">Cant.</th>
                <th class="text-right">P. Unit.</th>
                <th class="text-right">Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of compra.detalles">
                <td>
                  <div class="prod-name">{{ item.nombreProducto }}</div>
                  <div class="prod-code">{{ item.codigoProducto }}</div>
                </td>
                <td class="text-center">{{ item.cantidad }}</td>
                <td class="text-right">{{ item.precioUnitario | number:'1.2-2' }}</td>
                <td class="text-right fw-bold">{{ item.importeTotal | number:'1.2-2' }}</td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="3" class="text-right label-total">SUBTOTAL:</td>
                <td class="text-right">{{ compra.subTotal | number:'1.2-2' }}</td>
              </tr>
              <tr>
                <td colspan="3" class="text-right label-total">IGV:</td>
                <td class="text-right">{{ compra.igv | number:'1.2-2' }}</td>
              </tr>
              <tr class="total-row-highlight">
                <td colspan="3" class="text-right label-total-lg">TOTAL:</td>
                <td class="text-right amount-total-lg">{{ compra.total | number:'1.2-2' }}</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<ng-template #loadingTemplate>
  <div class="loading-container"><p>Cargando...</p></div>
</ng-template>