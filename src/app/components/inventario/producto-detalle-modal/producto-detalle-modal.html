<div class="modal-container">

  <div class="modal-header">
    <div class="header-content">
      <div class="product-icon-large">
        <mat-icon>inventory_2</mat-icon>
      </div>
      <div class="product-main-info">
        <h2>{{ producto.nombre }}</h2>
        <div class="badges-container">
          <span class="badge sku">
            <mat-icon style="font-size:14px; width:14px; height:14px;">qr_code</mat-icon>
            {{ producto.codigo }}
          </span>
          <span class="badge category">
            <mat-icon style="font-size:14px; width:14px; height:14px;">category</mat-icon>
            {{ producto.nombreCategoria }}
          </span>
          <span class="badge stock-status" [ngClass]="getEstadoStockClass()">
            {{ producto.estadoStock }}
          </span>
        </div>
      </div>
    </div>

    <div class="header-actions">
      <button mat-flat-button class="btn-edit" (click)="editarProducto()">
        <mat-icon>edit</mat-icon> Editar
      </button>
      <button mat-flat-button class="btn-delete" (click)="eliminarProducto()">
        <mat-icon>delete</mat-icon> Eliminar
      </button>
    </div>

    <button mat-icon-button class="close-btn" (click)="cerrar()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="modal-body">
    
    <div class="alert-card" *ngIf="mostrarStockBajo">
      <mat-icon>warning_amber</mat-icon>
      <div class="alert-content">
        <strong>Stock Bajo Detectado</strong>
        <span>Solo quedan {{ producto.stockActual }} unidades. El mínimo es {{ producto.stockMinimo }}.</span>
      </div>
    </div>

    <mat-tab-group animationDuration="0ms">
      
      <mat-tab label="Información General">
        <div class="tab-content">
          
          <div class="main-column">
            
            <div class="detail-card">
              <div class="card-header">
                <mat-icon>feed</mat-icon>
                <h3>Detalles del Producto</h3>
              </div>
              
              <div class="info-grid">
                <div class="info-item">
                  <span class="label">Código SKU</span>
                  <span class="value">{{ producto.codigo }}</span>
                </div>
                <div class="info-item">
                  <span class="label">Categoría</span>
                  <span class="value">{{ producto.nombreCategoria }}</span>
                </div>
                <div class="info-item full-width">
                  <span class="label">Descripción</span>
                  <p class="description">{{ producto.descripcion || 'Sin descripción' }}</p>
                </div>
              </div>

              <div class="warehouse-section">
                <h4 class="subsection-title">
                  <mat-icon>warehouse</mat-icon> Distribución en Almacenes
                </h4>
                
                <div *ngIf="cargandoAlmacenes" class="loading-state">Cargando...</div>

                <div class="warehouse-list" *ngIf="!cargandoAlmacenes && productosAlmacen.length > 0">
                  <div class="warehouse-item" *ngFor="let pa of productosAlmacen">
                    <div class="wh-icon"><mat-icon>store</mat-icon></div>
                    <div class="wh-info">
                      <strong>{{ pa.almacenNombre }}</strong>
                      <span class="wh-stock">{{ pa.stock }} unidades</span>
                    </div>
                  </div>
                  <div class="wh-total">
                    Total: <strong>{{ producto.stockActual }}</strong> en {{ productosAlmacen.length }} almacén(es)
                  </div>
                </div>

                <div class="empty-state-small" *ngIf="!cargandoAlmacenes && productosAlmacen.length === 0">
                  No asignado a almacenes
                </div>
              </div>
            </div>

          </div>

          <div class="side-column">
            
            <div class="kpis-container">
              <div class="card-header">
                <mat-icon>inventory</mat-icon>
                <h3>Stock e Inventario</h3>
              </div>
              <div class="kpi-row">
                <div class="kpi-item">
                  <span class="kpi-label">STOCK ACTUAL</span>
                  <span class="kpi-value primary">{{ producto.stockActual }}</span>
                  <span class="kpi-unit">unidades</span>
                </div>
                <div class="kpi-divider"></div>
                <div class="kpi-item">
                  <span class="kpi-label">STOCK MÍNIMO</span>
                  <span class="kpi-value secondary">{{ producto.stockMinimo }}</span>
                  <span class="kpi-unit">unidades</span>
                </div>
              </div>
              <div class="financial-summary">
                <div class="summary-row">
                  <span>Precio Unitario</span>
                  <strong>{{ formatearPrecio(producto.precioVenta) }}</strong>
                </div>
                <div class="summary-row total">
                  <span>Valor Total Stock</span>
                  <strong>{{ formatearPrecio(valorTotal) }}</strong>
                </div>
              </div>
            </div>

            <div class="info-section">
              <h3>Información Financiera ({{ producto.moneda || 'USD' }})</h3>
              <div class="financial-grid">
                <div class="f-row">
                  <span>Precio China</span>
                  <strong>{{ formatearPrecio(producto.precioChina) }}</strong>
                </div>
                <div class="f-row">
                  <span>Precio Venta</span>
                  <strong class="highlight">{{ formatearPrecio(producto.precioVenta) }}</strong>
                </div>
              </div>
            </div>

          </div>

        </div>
      </mat-tab>

      <mat-tab label="Movimientos">
        <div class="empty-tab">
          <mat-icon>history</mat-icon>
          <p>Próximamente: Historial de movimientos</p>
        </div>
      </mat-tab>

      <mat-tab label="Historial de Precios">
        <div class="empty-tab">
          <mat-icon>show_chart</mat-icon>
          <p>Próximamente: Gráfica de precios</p>
        </div>
      </mat-tab>

    </mat-tab-group>
  </div>
</div>