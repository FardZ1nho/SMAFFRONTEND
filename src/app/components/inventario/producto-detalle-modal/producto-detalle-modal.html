<div class="detalle-modal-container">

  <!-- Close Button -->
  <button mat-icon-button class="close-btn" (click)="cerrar()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- Header Card -->
  <div class="header-card">
    <div class="header-left">
      <div class="producto-avatar">
        <mat-icon>inventory_2</mat-icon>
      </div>
      <div class="producto-info">
        <h1>{{ producto.nombre }}</h1>
        <div class="meta-info">
          <span class="sku-badge">{{ producto.codigo }}</span>
          <mat-chip class="categoria-badge">
            <mat-icon>category</mat-icon>
            {{ producto.nombreCategoria }}
          </mat-chip>
          <mat-chip class="estado-badge" [ngClass]="getEstadoStockClass()">
            {{ producto.estadoStock }}
          </mat-chip>
        </div>
      </div>
    </div>
    <div class="header-actions">
      <button mat-raised-button class="btn-editar" (click)="editarProducto()">
        <mat-icon>edit</mat-icon>
        Editar
      </button>
      <button mat-raised-button class="btn-eliminar" (click)="eliminarProducto()">
        <mat-icon>delete</mat-icon>
        Eliminar
      </button>
    </div>
  </div>

  <!-- Stock Alert -->
  <div class="alert-card" *ngIf="mostrarStockBajo">
    <mat-icon>warning_amber</mat-icon>
    <div class="alert-content">
      <strong>Stock Bajo</strong>
      <span>{{ producto.stockActual }} unidades disponibles ‚Ä¢ M√≠nimo recomendado: {{ producto.stockMinimo }}</span>
    </div>
  </div>

  <!-- Content -->
  <div class="content-wrapper">

    <mat-tab-group class="custom-tabs" animationDuration="300ms" [(selectedIndex)]="selectedTab">

      <!-- Tab: Informaci√≥n General -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>info</mat-icon>
          Informaci√≥n General
        </ng-template>

        <div class="tab-content">

          <!-- Cards Grid -->
          <div class="cards-grid">

            <!-- Card 1: Detalles del Producto -->
            <div class="info-card">
              <div class="card-header">
                <mat-icon>inventory</mat-icon>
                <h3>Detalles del Producto</h3>
              </div>
              <div class="card-body">
                <div class="info-row">
                  <span class="label">C√≥digo SKU</span>
                  <span class="value">{{ producto.codigo }}</span>
                </div>
                <div class="info-row">
                  <span class="label">Categor√≠a</span>
                  <span class="value">{{ producto.nombreCategoria }}</span>
                </div>
                
                <!-- ‚úÖ MODIFICADO: Mostrar distribuci√≥n por almacenes -->
                <div class="info-row full-width">
                  <span class="label">
                    <mat-icon class="inline-icon">warehouse</mat-icon>
                    Distribuci√≥n en Almacenes
                  </span>
                  <div class="almacenes-distribucion">
                    <div *ngIf="cargandoAlmacenes" class="loading-small">
                      Cargando...
                    </div>
                    
                    <div *ngIf="!cargandoAlmacenes && productosAlmacen.length > 0" class="almacenes-lista">
                      <div class="almacen-item-small" *ngFor="let pa of productosAlmacen">
                        <mat-icon>store</mat-icon>
                        <div class="almacen-info-small">
                          <strong>{{ pa.almacenCodigo }} - {{ pa.almacenNombre }}</strong>
                          <span class="stock-badge">{{ pa.stock }} unidades</span>
                          <span *ngIf="pa.ubicacionFisica" class="ubicacion-fisica">
                            üìç {{ pa.ubicacionFisica }}
                          </span>
                        </div>
                      </div>
                      <div class="total-distribucion">
                        <strong>Total: {{ producto.stockActual }} unidades</strong>
                        <span>en {{ productosAlmacen.length }} almac√©n(es)</span>
                      </div>
                    </div>
                    
                    <div *ngIf="!cargandoAlmacenes && productosAlmacen.length === 0" class="sin-almacenes-small">
                      <mat-icon>info</mat-icon>
                      <span>No asignado a ning√∫n almac√©n</span>
                    </div>
                  </div>
                </div>
                
                <div class="info-row full-width">
                  <span class="label">Descripci√≥n</span>
                  <p class="descripcion">{{ producto.descripcion || 'Sin descripci√≥n disponible' }}</p>
                </div>
              </div>
            </div>

            <!-- Card 2: Stock e Inventario -->
            <div class="info-card highlight">
              <div class="card-header">
                <mat-icon>warehouse</mat-icon>
                <h3>Stock e Inventario</h3>
              </div>
              <div class="card-body">
                <div class="stock-display">
                  <div class="stock-item">
                    <span class="stock-label">Stock Actual</span>
                    <span class="stock-number" [ngClass]="getEstadoStockClass()">
                      {{ producto.stockActual }}
                    </span>
                    <span class="stock-unit">unidades</span>
                  </div>
                  <div class="stock-item">
                    <span class="stock-label">Stock M√≠nimo</span>
                    <span class="stock-number secondary">{{ producto.stockMinimo }}</span>
                    <span class="stock-unit">unidades</span>
                  </div>
                </div>

                <div class="divider"></div>

                <div class="info-row highlighted">
                  <span class="label">Precio Unitario</span>
                  <span class="value precio">{{ formatearPrecio(producto.precioVenta) }}</span>
                </div>
                <div class="info-row highlighted">
                  <span class="label">Valor Total en Stock</span>
                  <span class="value valor-total">{{ formatearPrecio(valorTotal) }}</span>
                </div>
              </div>
            </div>

            <!-- Card 3: Informaci√≥n Financiera -->
            <div class="info-card">
              <div class="card-header">
                <mat-icon>attach_money</mat-icon>
                <h3>Informaci√≥n Financiera ({{ producto.moneda || 'USD' }})</h3>
              </div>
              <div class="card-body">
                <div class="info-row">
                  <span class="label">Precio de China</span>
                  <span class="value">{{ formatearPrecio(producto.precioChina) }}</span>
                </div>
                <div class="info-row">
                  <span class="label">Costo Total</span>
                  <span class="value">{{ formatearPrecio(producto.costoTotal) }}</span>
                </div>
                <div class="info-row">
                  <span class="label">Precio de Venta</span>
                  <span class="value precio">{{ formatearPrecio(producto.precioVenta) }}</span>
                </div>
                <div class="info-row">
                  <span class="label">Margen de Ganancia</span>
                  <span class="value margen">{{ calcularMargen() }}</span>
                </div>
                <div class="info-row">
                  <span class="label">Unidad de Medida</span>
                  <span class="value">{{ producto.unidadMedida || 'UND' }}</span>
                </div>
              </div>
            </div>
            
            <!-- Card 4: Informaci√≥n Adicional -->
            <div class="info-card">
              <div class="card-header">
                <mat-icon>business</mat-icon>
                <h3>Informaci√≥n del Proveedor</h3>
              </div>
              <div class="card-body">
                <div class="empty-state">
                  <mat-icon>store</mat-icon>
                  <p>Sin proveedor asignado</p>
                  <span class="hint">Agrega un proveedor para este producto</span>
                </div>
              </div>
            </div>

          </div>
        </div>
      </mat-tab>

      <!-- Tab: Movimientos -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>history</mat-icon>
          Movimientos
        </ng-template>
        <div class="tab-content">
          <div class="empty-state-large">
            <mat-icon>history</mat-icon>
            <h3>Historial de Movimientos</h3>
            <p>Pr√≥ximamente podr√°s ver todos los movimientos de entrada y salida</p>
          </div>
        </div>
      </mat-tab>

      <!-- Tab: Historial de Precios -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon>show_chart</mat-icon>
          Historial de Precios
        </ng-template>
        <div class="tab-content">
          <div class="empty-state-large">
            <mat-icon>show_chart</mat-icon>
            <h3>Historial de Precios</h3>
            <p>Pr√≥ximamente podr√°s ver el hist√≥rico de cambios de precio</p>
          </div>
        </div>
      </mat-tab>

    </mat-tab-group>

  </div>

</div>